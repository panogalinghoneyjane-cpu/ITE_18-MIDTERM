<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laundry Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.7) 0%, rgba(118, 75, 162, 0.7) 100%), 
                        url('bg.jpg') center/cover no-repeat fixed;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            width: 100%;
            max-width: 500px;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dashboard-container {
            max-width: 1200px;
        }

        h1, h2 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        h1 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .switch-mode {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }

        .switch-mode a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .switch-mode a:hover {
            text-decoration: underline;
        }

        .hidden {
            display: none;
        }

        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dashboard-header h2 {
            color: white;
            margin: 0;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .dashboard-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .action-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .action-card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin: 10px 0;
        }

        .status-processing {
            background: #fff3cd;
            color: #856404;
        }

        .status-ready {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-otw {
            background: #cfe2ff;
            color: #084298;
        }

        .status-delivered {
            background: #d1e7dd;
            color: #0f5132;
        }

        .order-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .order-info p {
            margin: 10px 0;
            color: #555;
        }

        .order-info strong {
            color: #333;
        }

        .tracking-code {
            background: #667eea;
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 2px;
            margin: 20px 0;
        }

        .customer-section {
            border-top: 3px solid #667eea;
            padding-top: 30px;
            margin-top: 30px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-option {
            flex: 1;
        }

        .radio-option input[type="radio"] {
            width: auto;
            margin-right: 8px;
        }

        .radio-option label {
            display: inline;
            font-weight: normal;
        }

        .error {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
        }

        .success-message {
            background: #d1e7dd;
            color: #0f5132;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>
<body>

    <!-- Login/Signup Page -->
    <div id="authPage" class="container">
        <h1>üß∫ Washy Washy</h1>
        <p class="subtitle">Ampayon, Butuan City</p>

        <!-- Login Form -->
        <div id="loginForm">
            <h2>Log-in</h2>
            <form id="loginFormElement">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn">Login</button>
            </form>
            <div class="switch-mode">
                Don't have an account? <a href="#" onclick="showSignup()">Sign Up</a>
            </div>
        </div>

        <!-- Signup Form -->
        <div id="signupForm" class="hidden">
            <h2>Create Account</h2>
            <form id="signupFormElement">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="signupName" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="signupEmail" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="signupPassword" required>
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <select id="signupRole" required>
                        <option value="cashier">Cashier</option>
                        <option value="owner">Owner</option>
                    </select>
                </div>
                <button type="submit" class="btn">Sign Up</button>
            </form>
            <div class="switch-mode">
                Already have an account? <a href="#" onclick="showLogin()">Login</a>
            </div>
        </div>

        <!-- Customer Tracking Section -->
        <div class="customer-section">
            <h2>Customer Tracking</h2>
            <p class="subtitle">Track your laundry order</p>
            <form id="trackingForm">
                <div class="form-group">
                    <label>Enter Tracking Code</label>
                    <input type="text" id="trackingCode" placeholder="e.g., LDY-12345" required>
                </div>
                <button type="submit" class="btn btn-success">Track Order</button>
            </form>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboardPage" class="container dashboard-container hidden">
        <div class="dashboard-header">
            <div>
                <h2>Dashboard</h2>
                <p id="welcomeMessage">Welcome back!</p>
            </div>
            <div class="logout-btn" onclick="logout()">Logout</div>
        </div>

        <div class="dashboard-actions">
            <div class="action-card" onclick="showAddOrder()">
                <h3>‚ûï Add Order</h3>
                <p>Create new laundry order</p>
            </div>
            <div class="action-card" onclick="showAllOrders()">
                <h3>üìã View Orders</h3>
                <p>See all orders</p>
            </div>
            <div class="action-card" onclick="window.location.href='dashboard.html'">
    <h3>üè† Dashboard</h3>
    <p>View business information</p>
</div>
            <div class="action-card" onclick="window.location.href='reports.html'">
        <h3>üìä Reports</h3>
        <p>View monthly/annual reports</p>
           </div>
    </div>

        <div id="dashboardContent"></div>
    </div>

    <!-- Add Order Page -->
    <div id="addOrderPage" class="container hidden">
        <h2>Add New Order</h2>
        <form id="addOrderForm">
            <div class="form-group">
                <label>Customer Name</label>
                <input type="text" id="customerName" required>
            </div>

            <div class="form-group">
                <label>Contact Number</label>
                <input type="tel" id="customerPhone" required>
            </div>

            <div class="form-group">
                <label>Address</label>
                <textarea id="customerAddress" placeholder="Enter complete address" required></textarea>
            </div>

            <div class="form-group">
                <label>Type of Service</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="singleDrop" name="serviceType" value="Single Drop" checked>
                        <label for="singleDrop">Single Drop</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="doubleDrop" name="serviceType" value="Double Drop">
                        <label for="doubleDrop">Double Drop</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Weight (kg)</label>
                <input type="number" id="orderWeight" step="0.5" required>
            </div>

            <div class="form-group">
                <label>Payment Mode</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="cashPayment" name="paymentMode" value="Cash" checked>
                        <label for="cashPayment">Cash</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="onlinePayment" name="paymentMode" value="Online">
                        <label for="onlinePayment">Online Payment</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Delivery Option</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="pickup" name="deliveryOption" value="Pick Up" checked>
                        <label for="pickup">For Pick Up</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="delivery" name="deliveryOption" value="Delivery">
                        <label for="delivery">Delivery</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Amount (‚Ç±)</label>
                <input type="number" id="orderAmount" step="0.01" required>
            </div>

            <button type="submit" class="btn">Create Order</button>
            <button type="button" class="btn btn-secondary" onclick="showDashboard()">Cancel</button>
        </form>
    </div>

    <!-- Tracking Result Page -->
    <div id="trackingResultPage" class="container hidden">
        <h2>Order Status</h2>
        <div id="trackingResult"></div>
        <button class="btn btn-secondary" onclick="backToAuth()">Back</button>
    </div>

    <script>
        // Database connection will be handled by PHP
        // This is the frontend JavaScript

        let currentUser = null;

        // Show/Hide Forms
        function showLogin() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('signupForm').classList.add('hidden');
        }

        function showSignup() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('signupForm').classList.remove('hidden');
        }

        function showDashboard() {
            document.getElementById('authPage').classList.add('hidden');
            document.getElementById('dashboardPage').classList.remove('hidden');
            document.getElementById('addOrderPage').classList.add('hidden');
            document.getElementById('trackingResultPage').classList.add('hidden');
            loadDashboardData();
        }

        function showAddOrder() {
            document.getElementById('dashboardPage').classList.add('hidden');
            document.getElementById('addOrderPage').classList.remove('hidden');
        }

        function backToAuth() {
            document.getElementById('trackingResultPage').classList.add('hidden');
            document.getElementById('authPage').classList.remove('hidden');
        }

        function logout() {
            currentUser = null;
            document.getElementById('dashboardPage').classList.add('hidden');
            document.getElementById('authPage').classList.remove('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        }

        // Login Form Submit
        document.getElementById('loginFormElement').addEventListener('submit', async function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const formData = new FormData();
            formData.append('action', 'login');
            formData.append('email', email);
            formData.append('password', password);

            try {
                const response = await fetch('api.php', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.success) {
                    currentUser = data.user;
                    document.getElementById('welcomeMessage').textContent = `Welcome back, ${data.user.name}!`;
                    showDashboard();
                } else {
                    alert(data.message || 'Login failed');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });

        // Signup Form Submit
        document.getElementById('signupFormElement').addEventListener('submit', async function(e) {
            e.preventDefault();
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const role = document.getElementById('signupRole').value;

            const formData = new FormData();
            formData.append('action', 'signup');
            formData.append('name', name);
            formData.append('email', email);
            formData.append('password', password);
            formData.append('role', role);

            try {
                const response = await fetch('api.php', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.success) {
                    alert('Account created successfully!');
                    showLogin();
                    document.getElementById('signupFormElement').reset();
                } else {
                    alert(data.message || 'Signup failed');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });

        // Add Order Form Submit
        document.getElementById('addOrderForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const orderData = {
                action: 'addOrder',
                customerName: document.getElementById('customerName').value,
                customerPhone: document.getElementById('customerPhone').value,
                customerAddress: document.getElementById('customerAddress').value,
                serviceType: document.querySelector('input[name="serviceType"]:checked').value,
                weight: document.getElementById('orderWeight').value,
                paymentMode: document.querySelector('input[name="paymentMode"]:checked').value,
                deliveryOption: document.querySelector('input[name="deliveryOption"]:checked').value,
                amount: document.getElementById('orderAmount').value,
                userId: currentUser.id
            };

            const formData = new FormData();
            Object.keys(orderData).forEach(key => formData.append(key, orderData[key]));

            try {
                const response = await fetch('api.php', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.success) {
                    alert(`Order created successfully!\n\nTracking Code: ${data.trackingCode}\n\nPlease provide this code to the customer.`);
                    document.getElementById('addOrderForm').reset();
                    showDashboard();
                } else {
                    alert(data.message || 'Failed to create order');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });

        // Tracking Form Submit
        document.getElementById('trackingForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const trackingCode = document.getElementById('trackingCode').value.trim().toUpperCase();

            const formData = new FormData();
            formData.append('action', 'trackOrder');
            formData.append('trackingCode', trackingCode);

            try {
                const response = await fetch('api.php', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.success) {
                    displayTrackingResult(data.order);
                } else {
                    alert(data.message || 'Order not found');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });

        function displayTrackingResult(order) {
            const statusClass = {
                'Processing': 'status-processing',
                'Ready for Pickup': 'status-ready',
                'Out for Delivery': 'status-otw',
                'Delivered': 'status-delivered',
                'Picked Up': 'status-delivered'
            };

            const resultHTML = `
                <div class="tracking-code">${order.tracking_code}</div>
                <div class="order-info">
                    <p><strong>Customer:</strong> ${order.customer_name}</p>
                    <p><strong>Address:</strong> ${order.customer_address}</p>
                    <p><strong>Service Type:</strong> ${order.service_type}</p>
                    <p><strong>Delivery Option:</strong> ${order.delivery_option}</p>
                    <p><strong>Current Status:</strong></p>
                    <div class="status-badge ${statusClass[order.status]}">${order.status}</div>
                    <p><strong>Order Date:</strong> ${new Date(order.created_at).toLocaleDateString()}</p>
                </div>
            `;

            document.getElementById('trackingResult').innerHTML = resultHTML;
            document.getElementById('authPage').classList.add('hidden');
            document.getElementById('trackingResultPage').classList.remove('hidden');
        }

        async function loadDashboardData() {
            const formData = new FormData();
            formData.append('action', 'getOrders');
            formData.append('userId', currentUser.id);

            try {
                const response = await fetch('api.php', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.success) {
                    displayOrders(data.orders);
                }
            } catch (error) {
                console.error('Error loading orders:', error);
            }
        }

        function displayOrders(orders) {
            const content = document.getElementById('dashboardContent');
            
            if (!orders || orders.length === 0) {
                content.innerHTML = '<p style="text-align: center; color: #666;">No orders yet. Click "Add Order" to create one.</p>';
                return;
            }

            let html = '<h3 style="margin-bottom: 20px;">Recent Orders</h3>';
            html += '<div style="display: grid; gap: 15px;">';

            orders.forEach(order => {
                const statusClass = {
                    'Processing': 'status-processing',
                    'Ready for Pickup': 'status-ready',
                    'Out for Delivery': 'status-otw',
                    'Delivered': 'status-delivered',
                    'Picked Up': 'status-delivered'
                };

                html += `
                    <div class="order-info">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <p><strong>${order.customer_name}</strong></p>
                                <p style="font-size: 14px; color: #667eea;">${order.tracking_code}</p>
                                <p style="font-size: 12px; color: #999; margin-top: 5px;">üìç ${order.customer_address}</p>
                            </div>
                            <div class="status-badge ${statusClass[order.status]}">${order.status}</div>
                        </div>
                        <p style="margin-top: 10px;"><strong>Service:</strong> ${order.service_type} | <strong>‚Ç±${order.amount}</strong></p>
                        <button class="btn btn-success" style="margin-top: 10px; padding: 8px;" onclick="updateOrderStatus('${order.tracking_code}')">Update Status</button>
                        <button class="btn" style="margin-top: 10px; padding: 8px; background: #dc3545;" onclick="deleteOrderConfirm(${order.id}, '${order.tracking_code}')">üóëÔ∏è Delete</button>
                    </div>
                `;
            });

            html += '</div>';
            content.innerHTML = html;
        }

        async function updateOrderStatus(trackingCode) {
            const newStatus = prompt('Enter new status:\n1. Processing\n2. Ready for Pickup\n3. Out for Delivery\n4. Delivered\n5. Picked Up\n\nEnter number:');
            
            const statusMap = {
                '1': 'Processing',
                '2': 'Ready for Pickup',
                '3': 'Out for Delivery',
                '4': 'Delivered',
                '5': 'Picked Up'
            };

            if (!statusMap[newStatus]) {
                alert('Invalid selection');
                return;
            }

            const formData = new FormData();
            formData.append('action', 'updateStatus');
            formData.append('trackingCode', trackingCode);
            formData.append('status', statusMap[newStatus]);

            try {
                const response = await fetch('api.php', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.success) {
                    alert('Status updated successfully!');
                    loadDashboardData();
                } else {
                    alert(data.message || 'Failed to update status');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function showAllOrders() {
            loadDashboardData();
        }
        function deleteOrderConfirm(orderId, trackingCode) {
    if (confirm(`Are you sure you want to delete order ${trackingCode}? This action cannot be undone.`)) {
        deleteOrder(orderId, trackingCode);
    }
}

async function deleteOrder(orderId, trackingCode) {
    const formData = new FormData();
    formData.append('action', 'deleteOrder');
    formData.append('orderId', orderId);
    formData.append('trackingCode', trackingCode);

    try {
        const response = await fetch('api.php', {
            method: 'POST',
            body: formData
        });
        const data = await response.json();

        if (data.success) {
            alert('Order deleted successfully!');
            loadDashboardData();
        } else {
            alert(data.message || 'Failed to delete order');
        }
    } catch (error) {
        alert('Error: ' + error.message);
    }
}

    </script>

</body>
</html>